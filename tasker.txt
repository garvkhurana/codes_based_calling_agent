<TaskerData sr="" dvi="1" tv="6.0.9">
<Profile sr="prof1" ve="2">
<cdate>1640995200000</cdate>
<id>1</id>
<mid0>2</mid0>
<nme>AI Call Monitor</nme>
<Time sr="con0" ve="2">
<fh>0</fh>
<fm>0</fm>
<fs>30</fs>
<th>23</th>
<tm>59</tm>
<ts>59</ts>
</Time>
</Profile>
<Task sr="task2">
<cdate>1640995200000</cdate>
<id>2</id>
<nme>Check Firebase and Call</nme>
<Action sr="act0" ve="7">
<code>116</code>
<Str sr="arg0" ve="3">https://calling-agent-adb57-default-rtdb.firebaseio.com/tasker_commands.json</Str>
<Str sr="arg1" ve="3"></Str>
<Str sr="arg2" ve="3"></Str>
<Str sr="arg3" ve="3"></Str>
<Int sr="arg4" val="10"/>
<Str sr="arg5" ve="3">%http_response</Str>
</Action>
<Action sr="act1" ve="7">
<code>349</code>
<Str sr="arg0" ve="3">
var response = global('http_response');
if (response) {
    try {
        var data = JSON.parse(response);
        if (data && data.trigger === true && data.phone_number) {
            setGlobal('call_number', data.phone_number);
            setGlobal('call_name', data.caller_name || 'Unknown');
            setGlobal('call_reason', data.call_reason || 'No reason');
            setGlobal('should_make_call', 'yes');
            
            // Update Firebase status
            global('firebase_status') = 'calling';
        }
    } catch(e) {
        flash('Firebase parse error: ' + e);
    }
}
</Str>
<Str sr="arg1" ve="3"></Str>
<Int sr="arg2" val="1"/>
<Int sr="arg3" val="45"/>
</Action>
<Action sr="act2" ve="7">
<code>37</code>
<ConditionList sr="if">
<Condition sr="c0" ve="3">
<lhs>%should_make_call</lhs>
<op>2</op>
<rhs>yes</rhs>
</Condition>
</ConditionList>
</Action>
<Action sr="act3" ve="7">
<code>118</code>
<Str sr="arg0" ve="3">https://calling-agent-adb57-default-rtdb.firebaseio.com/tasker_commands/status.json</Str>
<Str sr="arg1" ve="3"></Str>
<Str sr="arg2" ve="3">"calling"</Str>
<Str sr="arg3" ve="3">application/json</Str>
<Int sr="arg4" val="10"/>
<Str sr="arg5" ve="3"></Str>
</Action>
<Action sr="act4" ve="7">
<code>19</code>
<Str sr="arg0" ve="3">Making call to %call_name</Str>
<Int sr="arg1" val="4"/>
<Int sr="arg2" val="1"/>
</Action>
<Action sr="act5" ve="7">
<code>35</code>
<Str sr="arg0" ve="3">%call_number</Str>
<Int sr="arg1" val="1"/>
</Action>
<Action sr="act6" ve="7">
<code>30</code>
<Int sr="arg0" val="0"/>
<Int sr="arg1" val="5"/>
<Int sr="arg2" val="0"/>
<Int sr="arg3" val="0"/>
<Int sr="arg4" val="0"/>
</Action>
<Action sr="act7" ve="7">
<code>118</code>
<Str sr="arg0" ve="3">https://calling-agent-adb57-default-rtdb.firebaseio.com/tasker_commands/status.json</Str>
<Str sr="arg1" ve="3"></Str>
<Str sr="arg2" ve="3">"connected"</Str>
<Str sr="arg3" ve="3">application/json</Str>
<Int sr="arg4" val="10"/>
<Str sr="arg5" ve="3"></Str>
</Action>
<Action sr="act8" ve="7">
<code>547</code>
<Str sr="arg0" ve="3">should_make_call</Str>
<Str sr="arg1" ve="3">no</Str>
<Int sr="arg2" val="0"/>
<Int sr="arg3" val="0"/>
<Int sr="arg4" val="0"/>
</Action>
<Action sr="act9" ve="7">
<code>43</code>
</Action>
</Task>
</TaskerData>